---
title: "Intro to Spatial Analysis in R"
author: Andrew Murray
date: "January 23, 2020"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(raster)
library(dplyr)
library(here)
```

## Overview

- R has powerful GIS capabilities which are constantly growing thanks to the expanding number of available packages.
- ```sf``` is the most important R package to handle vector data. ```sf``` is a successor of ```sp```, but it's still evolving. Moreover, many older R packages depend on the functions and classes for the ```sp``` package (though this is becoming less and less so).
- ```raster``` is an extension of spatial data classes to work with rasters.
- There are many ways to vizualize spatial data in R, for example ```ggplot2```, ```rasterVis```, ```tmap```, ```leaflet```, and ```mapview``` packages
- It is easy to connect R with a GIS software - GRASS GIS (rgrass7), SAGA (RSAGA), QGIS (RQGIS), and ArcGIS (arcgisbinding)

## Vector Data
### The ```sf``` package

The ```sf``` package is the implementation of the [simple features standard](https://r-spatial.github.io/sf/articles/sf1.html) and incorporates:

- Most of the functions start with the prefix st_
  - st_read()
  - st_area()
  - st_transform()
- You need a recent version of the GDAL, GEOS, Proj.4, and UDUNITS libraries installed for this to work on Mac and Linux.

## Reading Spatial Data

```{r}
HUC8 <- st_read(here('shp/HUC8.shp'))
```

## Reading Spatial Data from a text file
```{r}
gauges <- read.csv(here("csv/gaugesR02.csv"))
colnames(gauges)
gauges_sf <- st_as_sf(gauges, coords = c("LONGDD","LATDD"))
gauges_sf
```

## Writing spatial Data

```{r}
# Make sure data is formatted the way we want it (In this case, site number should be text)
class(gauges_sf$SITENO)
gauges_sf$SITENO <- as.character(gauges_sf$SITENO)

# Write the file
write_sf(gauges_sf,here("shp/gauges.shp"))
```

## ```sf``` structure

```{r}
class(HUC8)
```

```sf``` objects usually have two classes - sf and data.frame. Two main differences comparing to a regular data.frame object are spatial metadata (geometry type, dimension, bbox, epsg (SRID), proj4string) and additional column - typically named geom or geometry.

```{r}
# brackets[] subset a vector by [rows,columns]
HUC8[1:4,10:12]
```

## Attributes

sf object can be used as a regular data.frame object in many operations
```head (HUC8)```
```nrow(HUC8)```
```ncol(HUC8)```
```HUC8[,c(10,)]```
```HUC8[1:5,2]```

The 'geometry' column of an sf object is what is used to draw a spatial object. This can be changed or removed using:
```st_set_geometry(HUC8, NULL)```

## The ```dplyr``` package and ```sf```

- ```dplyr``` is a package used to manage and organize your data (filtering, ordering, making new columns from old columns etc...)

- ```select``` for example allows you to keep only the columns you want.

```{r}
HUC8_sel <- select(HUC8, GNIS_ID, Name, States, HUC8, AreaSqKm)
```

## The ```dplyr``` package and ```sf```

```arrange()```

```{r}
HUC8_arr <- arrange(HUC8_sel,Name)
HUC8_arr
```

## The ```dplyr``` package and ```sf```

```filter()```
```{r}
HUC8_NC <- filter(HUC8_sel, States %in% "NC")
HUC8_NC
```

